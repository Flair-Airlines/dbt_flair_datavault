{{
    config(
        materialized = 'incremental',
        incremental_strategy = 'merge',
        unique_key = 'RESERVATION_SEGMENT_SURROGATE_ID_HASH'
    )
}}
select 
{{ dbt_utils.generate_surrogate_key([
     'LNG_RES_SEGMENTS_ID_NMBR'
]) }} as RESERVATION_SEGMENT_SURROGATE_ID_HASH,
LNG_RES_SEGMENTS_ID_NMBR,
RS.DTM_LAST_MOD_DATE,
LNG_CODESHARE_OPTION,
LNG_SEAT_ALLOCATION_ID_NMBR,
STR_MARKETING_CARRIER_CODE,
RS.LNG_RES_LEGS_ID_NMBR,
RS.LNG_CREATION_USER_ID_NMBR,
STR_RES_THRU_SEGMENT,
STR_RES_ALERT,
STR_SPECIAL_NEEDS,
STR_BOARDING_PASS_NMBR,
RS.DTM_CREATION_DATE,
RS.LNG_LAST_MOD_USER_ID_NMBR,
RS.DTM_CREATION_DATE as TSP_TIMESTAMP,
STR_MARKETING_CARRIER_RBD,
RS.STR_EMAIL_ALERT,
LNG_SKED_DETAIL_ID_NMBR,
STR_RES_CHECKIN_BOARDED,
STR_MARKETING_CARRIER_FLIGHT_NUMBER,
LNG_FARE_ALLOCATION_ID_NMBR,
STR_RES_STATUS,
TRUE as LATEST_INDICATOR,
CURRENT_TIMESTAMP() AS INSERTED_TS,
to_timestamp('1900-01-01','YYYY-MM-DD') as EFFECTIVE_DATETIME,
NULL AS EXPIRY_DATETIME,
{{ dbt_utils.generate_surrogate_key([
     'LNG_RES_SEGMENTS_ID_NMBR'
]) }} as ORIGINAL_SURROGATE_ID_HASH,
RL.RESERVATION_SURROGATE_ID_HASH,				
RL.RESERVATION_LEG_SURROGATE_ID_HASH
from {{ source('PSS_AMELIARES_DBO', 'TBL_RES_SEGMENTS') }} RS
LEFT JOIN {{ ref('reservation_leg_dim') }} RL ON RS.LNG_RES_LEGS_ID_NMBR = RL.LNG_RES_LEGS_ID_NMBR

--where RS.LNG_RES_LEGS_ID_NMBR = 8361240 AND LNG_SKED_DETAIL_ID_NMBR= 72274 AND LNG_SEAT_ALLOCATION_ID_NMBR = 408729
